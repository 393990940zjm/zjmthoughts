(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11aff2a4"],{3212:function(e,t,a){"use strict";var i=a("eb15"),r=a.n(i);r.a},"3d99":function(e,t,a){"use strict";var i=a("a96d"),r=a.n(i);r.a},"497f":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"h100"},[e.$route.query.isWorkstation?a("sHeader",{attrs:{titleName:e.WORK_STATION.EQUIPMENT_CHECKING}},[a("div",{staticClass:"head-operation",attrs:{slot:"header-action"},slot:"header-action"},[a("HeaderAction",{attrs:{name:"1"},on:{onOprationItem:function(t){return e.goHome()}}},[a("el-button",{attrs:{slot:"action"},slot:"action"},[a("i",{staticClass:"el-icon-d-arrow-left"}),e._v(e._s(e.BTN_TEXT.RETURN)+" ")])],1)],1)]):e._e(),a("el-container",{class:{"content-workstation":e.$route.query.isWorkstation}},[e.$route.query.isWorkstation?e._e():a("el-header",[a("HeaderTitle",{staticClass:"header-title"})],1),a("el-main",{class:{"el-main-workstation":e.$route.query.isWorkstation}},[a("div",{staticClass:"area-main"},[a("div",{staticClass:"area-aside"},[a("HeaderTitle",{staticClass:"header-title",attrs:{titleName:e.DEVICE_CHECK.DEVICE_LIST}},[a("div",{staticClass:"head-operation",attrs:{slot:"head-operation"},slot:"head-operation"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showRole(1),expression:"showRole(1)"}],attrs:{type:"danger",size:"mini"},on:{click:e.holidayAllFree}},[e._v(e._s(e.DEVICE_CHECK.HOLIDAY_ALL_FREE))])],1)]),a("div",{staticClass:"area-tree"},[a("div",{staticClass:"area-zTree"},[a("ZTree",{attrs:{isExpendAll:!0,nodes:e.nodeData},on:{ztreeOnClick:e.ztreeOnClick,ztreeHandleCreated:e.ztreeHandleCreated}})],1)])],1),a("div",{staticClass:"area-info"},[[a("div",{staticClass:"userInformation"},[a("el-radio-group",{model:{value:e.tabPosition,callback:function(t){e.tabPosition=t},expression:"tabPosition"}},[a("el-radio-button",{attrs:{label:"prev"}},[e._v(e._s(e.DEVICE_CHECK.PREV_SHIFT))]),a("el-radio-button",{attrs:{label:"now"}},[e._v(e._s(e.DEVICE_CHECK.NOW_SHIFT))]),a("el-radio-button",{attrs:{label:"histroy"}},[e._v(e._s(e.DEVICE_CHECK.HISTROY_SHIFT))])],1),"histroy"!==e.tabPosition?a("checkItemList",{ref:"checkItemList",attrs:{tabPosition:e.tabPosition,deviceCode:e.ztreeSelectedNode.code},on:{changeNode:e.changeNode,holidayFree:e.holidayFree}}):e._e(),a("checkHistroy",{directives:[{name:"show",rawName:"v-show",value:"histroy"===e.tabPosition&&!e.showItem,expression:"tabPosition==='histroy' && !showItem "}],ref:"checkHistroy",attrs:{deviceCode:e.ztreeSelectedNode.code},on:{toggleHistroyItem:e.toggleHistroyItem}}),"histroy"===e.tabPosition&&e.showItem?a("checkHistroyItem",{ref:"checkHistroyItem",attrs:{deviceCode:e.ztreeSelectedNode.code,yearMonthDay:e.histroyMonth+"-"+e.histroyDay},on:{toggleHistroyItem:e.toggleHistroyItem}}):e._e()],1)]],2)])])],1)],1)},r=[],n=(a("d81d"),a("a9e3"),a("ac1f"),a("5319"),a("96cf"),a("1da1")),c=a("5530"),s=a("85a8"),o=a("5861"),l=a("1660"),u=a("ac6c"),h=a("c1df"),d=a.n(h),f=a("bd1e"),m=a("3fa5"),v=a("6464"),p=a("582a"),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"content"},[a("el-main",[a("vxe-grid",{ref:"xGrid",staticClass:"vxe-table-element",attrs:{border:"full",resizable:"","keep-source":"",height:"350",columns:e.tableColumns,data:e.tableDatas,"edit-config":{trigger:"click",mode:"cell",showStatus:!1,icon:"fa fa-file-text-o"}},on:{"edit-actived":e.editActivedEvent}}),a("p",{directives:[{name:"show",rawName:"v-show",value:e.canReviewCheck,expression:"canReviewCheck"}],staticStyle:{"text-align":"left"}},[e._v("审核情况："+e._s(e.reviewText())+" ")]),a("div",{staticClass:"checkInfo"},[a("span",[e._v(e._s(e.DEVICE_CHECK.JOB_DESCRIPTION)+":")]),a("el-input",{attrs:{type:"textarea",placeholder:e.CONSTANTS_CODE.PLEASE_ENTER_CONTENT,rows:3,disabled:0===e.tableDatas.length||e.saveFalg,maxlength:"200","show-word-limit":""},model:{value:e.checkRemarks,callback:function(t){e.checkRemarks=t},expression:"checkRemarks"}}),a("el-upload",{ref:"upload",attrs:{"list-type":"picture-card",disabled:0===e.tableDatas.length||e.saveFalg,headers:e.uploadConfig.headers,action:e.uploadConfig.url,data:e.uploadConfig.data,"before-upload":e.updateFiles,"file-list":e.fileList,"on-success":e.updateSuccess,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[a("i",{staticClass:"el-icon-plus"})]),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),a("div",{staticClass:"btnDiv"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showRole(2),expression:"showRole(2)"}],attrs:{type:"danger",disabled:0===e.tableDatas.length||e.saveFalg},on:{click:e.holidayFree}},[e._v(e._s(e.DEVICE_CHECK.HOLIDAY_FREE))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.saveFalg,expression:"saveFalg"}],attrs:{disabled:0===e.tableDatas.length},on:{click:e.recovery}},[e._v(e._s(e.BTN_TEXT.RECOVERY))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.saveFalg,expression:"!saveFalg"}],attrs:{disabled:0===e.tableDatas.length||e.saveFalg},on:{click:e.halt}},[e._v(e._s(e.BTN_TEXT.HALT))]),a("el-input",{staticClass:"shiftNow",attrs:{readonly:!0},model:{value:e.nowShift,callback:function(t){e.nowShift=t},expression:"nowShift"}}),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showRole(3),expression:"showRole(3)"}],attrs:{disabled:0===e.tableDatas.length||e.saveFalg},on:{click:e.allSelect}},[e._v(e._s(e.DEVICE_CHECK.ALL_SELECT))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showRole(4),expression:"showRole(4)"}],attrs:{disabled:0===e.tableDatas.length||e.saveFalg,type:"primary"},on:{click:e.submit}},[e._v(e._s(e.BTN_TEXT.SAVE))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.canReviewCheck,expression:"canReviewCheck"}],attrs:{type:"primary",disabled:0===e.tableDatas.length||e.saveFalg},on:{click:e.checkReview}},[e._v("审核")]),a("el-input",{staticClass:"nowDate",attrs:{readonly:!0},model:{value:e.nowDate,callback:function(t){e.nowDate=t},expression:"nowDate"}})],1),a("el-dialog",{attrs:{title:e.TITLE.PROMPT,visible:e.dialogRepirVisible,width:"30%"},on:{"update:visible":function(t){e.dialogRepirVisible=t}}},[a("span",[e._v(e._s(e.DEVICE_CHECK.INSERT_CHECK_REPAIRTASK))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogRepirVisible=!1}}},[e._v(e._s(e.BTN_TEXT.CLOSE))]),a("el-button",{attrs:{type:"primary"},on:{click:e.insertCheckRepairTask}},[e._v(e._s(e.BTN_TEXT.CONFIRM))])],1)]),a("el-dialog",{attrs:{title:"提示",visible:e.centerDialogVisible,width:"500px",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("span",[e._v("请对本次点检任务进行审核")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.checkReviewPass()}}},[e._v("通过")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.checkReviewNoPass()}}},[e._v("不通过")])],1)])],1)],1)},g=[],k=(a("d3b7"),a("25f0"),a("b58d")),w=a("8593"),C=a("cf45"),O={components:{HeaderTitle:s["a"],HeadOperationItem:o["a"]},props:{deviceCode:{type:String,default:""},tabPosition:{type:String,default:"now"}},data:function(){var e=this,t=this.$createElement;return{DEVICE_CHECK:p["o"],BTN_TEXT:p["c"],TITLE:p["N"],CONSTANTS_CODE:p["h"],saveFalg:!1,selectedShift:null,shiftData:{},nowShift:"",repairFlag:!1,nowDate:"",options:[],tableDatas:[],repairRemark:[],dialogRepirVisible:!1,checkRemarks:"",tableColumns:[{type:"seq",title:p["P"].SEQ,align:"center"},{field:"itemName",title:p["g"].CHECK_ITEM,align:"center"},{field:"checkState",title:p["g"].IS_FINISH,align:"center",slots:{default:function(a){var i=a.row;a.column;return 0===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-unChecked"})]:1===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,2)}},class:"icon-checked"})]:2===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,0)}},class:"icon-no"})]:3===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-stop"})]:4===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-holiday"})]:void 0}}},{field:"value",title:p["g"].REAL_VALUE,align:"center",editRender:{name:"input"}}],relationshipId:"",dialogImageUrl:"",fileList:[],delFileList:[],dialogVisible:!1,uploadConfig:{headers:{token:window.localStorage.getItem("token").replace(/"/g,"")},url:p["E"].PUBLICIP+"fileResource/uploadOneFile.action",data:{fileResourceTypeEnum:p["z"].CHECK_RECORD_IMAGE,relationshipId:""}},canReviewCheck:!1,centerDialogVisible:!1,checkRecord:{}}},computed:{},created:function(){this.getNowDate(),this.showReviewCheck()},mounted:function(){},methods:{showRole:function(e){for(var t=Object(C["c"])("id"),a=Object(c["a"])({},this.$store.state.pageInfo[t]),i=a.buttonList,r=0;r<i.length;r++)if(e===Number(i[r].type))return!0;return!1},toggleFinish:function(e,t){e.checkState=t},editActivedEvent:function(e){e.row,e.rowIndex;this.valueDisabled=!0},searchItem:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.getCheckRepairTaskSwitch(),e.$refs.xGrid.clearActived(),e.fileList=[],e.saveFalg=!1,e.checkRemarks="",e.nowShift="",e.tableDatas=[],e.options=[],e.selectedShift=null,""!==e.deviceCode){t.next=12;break}return Object(m["c"])(p["o"].PLEASE_CHOOSE_DEVICE),t.abrupt("return",!1);case 12:if("now"!==e.tabPosition){t.next=42;break}return t.prev=13,t.next=16,Object(k["b"])({deviceCode:e.deviceCode});case 16:if(a=t.sent,a.code!==p["M"].OPERATION_SUCCESS){t.next=32;break}if(a.rows.templateId){t.next=21;break}return Object(m["c"])(p["g"].NOW_NOTHING),t.abrupt("return",!1);case 21:for(i in a.rows.checkList)3===a.rows.checkList[i].checkState||4===a.rows.checkList[i].checkState?e.saveFalg=!0:e.saveFalg=!1;e.shiftData=a.rows,e.tableDatas=a.rows.checkList,e.selectedShift=a.rows.shiftId,e.checkRecord=a.rows.checkRecord,e.relationshipId=a.rows.checkRecord.recordId,e.checkRemarks=a.rows.checkRecord.checkInformation,e.nowShift=a.rows.shiftName+":"+a.rows.shiftStartTime+"~"+a.rows.shiftEndTime,e.getFileList(a.rows.checkImageList),t.next=33;break;case 32:Object(m["c"])(a.message);case 33:t.next=38;break;case 35:t.prev=35,t.t0=t["catch"](13),Object(v["a"])(p["N"].NOTIFY,t.t0);case 38:return t.prev=38,t.finish(38);case 40:t.next=70;break;case 42:if("prev"!==e.tabPosition){t.next=70;break}return t.prev=43,t.next=46,Object(k["f"])({deviceCode:e.deviceCode});case 46:if(r=t.sent,r.code!==p["M"].OPERATION_SUCCESS){t.next=62;break}if(r.rows.templateId){t.next=51;break}return Object(m["c"])(p["g"].NOW_NOTHING),t.abrupt("return",!1);case 51:for(n in r.rows.checkList)3===r.rows.checkList[n].checkState||4===r.rows.checkList[n].checkState?e.saveFalg=!0:e.saveFalg=!1;e.shiftData=r.rows,e.tableDatas=r.rows.checkList,e.selectedShift=r.rows.shiftId,e.checkRecord=r.rows.checkRecord,e.relationshipId=r.rows.checkRecord.recordId,e.checkRemarks=r.rows.checkRecord.checkInformation,e.nowShift=r.rows.shiftName+":"+r.rows.shiftStartTime+"~"+r.rows.shiftEndTime,r.rows.checkImageList&&e.getFileList(r.rows.checkImageList),t.next=63;break;case 62:Object(m["c"])(r.message);case 63:t.next=68;break;case 65:t.prev=65,t.t1=t["catch"](43),Object(v["a"])(p["N"].NOTIFY,t.t1);case 68:return t.prev=68,t.finish(68);case 70:case"end":return t.stop()}}),t,null,[[13,35,38,40],[43,65,68,70]])})))()},allSelect:function(){this.tableDatas=this.tableDatas.map((function(e){return e.checkState=1,e}))},submit:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.repairRemark=[],a=e.tableDatas.map((function(t){var a={id:t.id,value:t.value,checkState:t.checkState};return 2===t.checkState&&e.repairRemark.push(t.itemName),t.checkState,a})),i=e.fileList.map((function(e){var t="";return t=e.flag?e.id:e.response.rows.resourceId,t})),t.prev=3,t.next=6,Object(k["y"])({recordId:e.relationshipId,checkInformation:e.checkRemarks,resourceIdListStr:i.toString()},a);case 6:if(r=t.sent,r.code===p["M"].OPERATION_SUCCESS){for(c in n=!0,a)0===a[c].checkState&&(n=!1);0!==e.delFileList.length&&e.delImg(),0!==e.repairRemark.length&&e.repairFlag&&(e.dialogRepirVisible=!0),"now"===e.tabPosition&&e.$emit("changeNode",n),Object(m["b"])(r.message)}else Object(m["c"])(r.message);t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](3),Object(v["a"])(p["N"].NOTIFY,t.t0);case 13:return t.prev=13,t.finish(13);case 15:case"end":return t.stop()}}),t,null,[[3,10,13,15]])})))()},holidayFree:function(){this.$emit("holidayFree")},goBack:function(){this.$emit("goBack",p["P"].ZERO_NUMBER)},getNowDate:function(){var e=this;e.nowDate=d()((new Date).getTime()).format("YYYY-MM-DD"),setInterval((function(){e.nowDate=d()((new Date).getTime()).format("YYYY-MM-DD")}),500)},handleRemove:function(e,t){e.flag?(this.delFileList.push(e.id),this.fileList=t):(this.delFileList.push(e.response.rows.resourceId),this.fileList=t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},updateFiles:function(){if(!this.deviceCode)return Object(m["c"])(p["o"].PLEASE_CHOOSE_DEVICE),!1},updateSuccess:function(e,t,a){this.fileList.push(t),e.code,this.GLOBAL.STATUS_CODE.OPERATION_SUCCESS},getFileList:function(e){var t=e.map((function(e){var t={id:e.resourceId,url:p["E"].PUBLICIP+e.fileUrl,relationshipId:e.relationshipId,flag:!0};return t}));this.delFileList=[],this.fileList=t},delImg:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["A"])({ids:e.delFileList},[]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?e.delFileList=[]:Object(m["c"])(a.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[0,7,10,12]])})))()},recovery:function(){this.saveFalg=!1},halt:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,c,s,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs.xGrid.clearActived(),a=(new Date).getTime(),i=new Date(e.tableDatas[0].checkStartTime).getTime(),r=new Date(e.tableDatas[0].checkEndTime).getTime()+1e3*e.shiftData.extensionTime,!(i>a||a>r)){t.next=7;break}return Object(m["c"])(p["o"].CHECK_TIMEOUT),t.abrupt("return",!1);case 7:return n=e.tableDatas.map((function(e){var t={id:e.id,value:e.value,checkState:3};return t})),c=e.fileList.map((function(e){var t="";return t=e.flag?e.id:e.response.rows.resourceId,t})),t.prev=9,t.next=12,Object(k["y"])({recordId:e.relationshipId,checkInformation:e.checkRemarks,resourceIdListStr:c.toString()},n);case 12:if(s=t.sent,s.code===p["M"].OPERATION_SUCCESS){for(l in o=!0,n)0===n[l].checkState&&(o=!1);0!==e.delFileList.length&&e.delImg(),"now"===e.tabPosition&&e.$emit("changeNode",o),e.searchItem(),Object(m["b"])(s.message)}else Object(m["c"])(s.message);t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](9),Object(v["a"])(p["N"].NOTIFY,t.t0);case 19:return t.prev=19,t.finish(19);case 21:case"end":return t.stop()}}),t,null,[[9,16,19,21]])})))()},getCheckRepairTaskSwitch:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["B"])({},[]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS&&(e.repairFlag=a.rows),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[0,7,10,12]])})))()},insertCheckRepairTask:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["F"])({deviceCode:e.deviceCode,repairRemark:e.repairRemark},[]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.dialogRepirVisible=!1,Object(m["b"])(a.message)):Object(m["c"])(a.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[0,7,10,12]])})))()},showReviewCheck:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(w["a"])({configurationTypeEnum:"CHECK_REVIEW"},{});case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(console.log(a),1===a.rows.isEnable?e.canReviewCheck=!0:e.canReviewCheck=!1):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},checkReview:function(){0===this.checkRecord.checkState?Object(m["c"])("未完成点检，无法进行审核！"):this.centerDialogVisible=!0},checkReviewPass:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["q"])({},[e.relationshipId]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.centerDialogVisible=!1,Object(m["b"])(a.message),e.searchItem()):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},checkReviewNoPass:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["x"])({},[e.relationshipId]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.centerDialogVisible=!1,Object(m["b"])(a.message),e.searchItem()):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},reviewText:function(){return this.checkRecord.reviewState?1===this.checkRecord.reviewState?"【"+this.checkRecord.reviewedByName+"】审核通过":"【"+this.checkRecord.reviewedByName+"】审核不通过":"未审核"}}},I=O,E=I,R=(a("6350"),a("2877")),S=Object(R["a"])(E,b,g,!1,null,"2cdb6135",null),T=S.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"content"},[a("el-main",[a("div",{staticClass:"histroyContent"},e._l(e.tableDatas,(function(t,i){return a("div",{key:i,staticClass:"histroyDiv",on:{click:function(a){return e.showItem(t)}}},[a("div",{staticClass:"cardBackground",style:{"background-color":e.styleDict(t)}},[a("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.moment(t.dayDateTime).format("DD"))),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.getWeekdayFromDate(t.dayDateTime)))])]),e._l(t.shiftUserCheckVoList,(function(i,r){return a("div",{key:r,staticClass:"shiftDiv"},[a("span",{style:{color:e.styleShift(i,t.dayDateTime)}},[e._v(e._s(i.shiftName)+":"+e._s(""===i.realNameList.join(",")?e.VARIABLE.NOT_HAVE:i.realNameList.join(","))),e.canReviewCheck?a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.reviewText(i.checkRecord)))]):e._e()])])}))],2)])})),0),a("div",{staticClass:"monthContent"},[a("el-date-picker",{attrs:{clearable:!1,align:"center",type:"month","value-format":"yyyy-MM",placeholder:"选择月"},on:{change:e.searchItem},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}})],1)])],1)},N=[],y=(a("1276"),{components:{HeaderTitle:s["a"],HeadOperationItem:o["a"]},props:{deviceCode:{type:String,default:""}},data:function(){return{BTN_TEXT:p["c"],VARIABLE:p["P"],month:"",tableDatas:[],canReviewCheck:!1}},computed:{},created:function(){this.month=d()((new Date).getTime()).format("YYYY-MM")},mounted:function(){},methods:{toggleFinish:function(e,t){e.isFinish=t},searchItem:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showReviewCheck(),e.tableDatas=[],""!==e.deviceCode){t.next=5;break}return Object(m["c"])(p["o"].PLEASE_CHOOSE_DEVICE),t.abrupt("return",!1);case 5:return t.prev=5,t.next=8,Object(k["c"])({deviceCode:e.deviceCode,yearMonth:e.month});case 8:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?e.tableDatas=a.rows:Object(m["c"])(a.message),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](5),Object(v["a"])(p["N"].NOTIFY,t.t0);case 15:return t.prev=15,t.finish(15);case 17:case"end":return t.stop()}}),t,null,[[5,12,15,17]])})))()},showItem:function(e){if(0===e.shiftUserCheckVoList.length)return Object(m["c"])(p["o"].NOT_CHECK_INFO),!1;var t=d()(e.dayDateTime).format("DD");this.$emit("toggleHistroyItem",t,this.month)},styleDict:function(e){var t=e.shiftUserCheckVoList;if(t.length>0){for(var a=0,i=0;i<t.length;i++)t[i].userIdList.length>0&&-1!==t[i].userIdList[0]&&a++;return a===t.length?"#D4ECC8":a<t.length&&a>0?"#FFEFD4":"#FFFFFF"}return"#FFFFFF"},styleShift:function(e,t){if(e.isFinish){if(e.shiftInformation.showColorList&&e.shiftInformation.showColorList.length>0){for(var a="red",i=e.shiftInformation.showColorList,r=0;r<i.length;r++){var n=i[r].startHHmm.split(":"),c=i[r].endHHmm.split(":"),s=0,o=0,l=60*Number(n[0])+Number(n[1]),u=60*Number(c[0])+Number(c[1]),h=new Date(t.substring(0,10)+" 00:00:00").getTime(),d=new Date(e.shiftInformation.updateTime).getTime();l>u?(s=h+60*(60*Number(n[0])+Number(n[1]))*1e3,o=h+864e5+60*(60*Number(c[0])+Number(c[1]))*1e3):(s=h+60*(60*Number(n[0])+Number(n[1]))*1e3,o=h+60*(60*Number(c[0])+Number(c[1]))*1e3),s<=d&&d<=o&&(a=i[r].color)}return a}return"green"}return"red"},showReviewCheck:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(1111),t.prev=1,t.next=4,Object(w["a"])({configurationTypeEnum:"CHECK_REVIEW"},{});case 4:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(console.log(a),1===a.rows.isEnable?(console.log(a.rows.isEnable),e.canReviewCheck=!0):(console.log(a.rows.isEnable),e.canReviewCheck=!1)):Object(m["c"])(a.message),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[1,8,10,12]])})))()},reviewText:function(e){return console.log(e),e.reviewState?1===e.reviewState?"【"+e.reviewedByName+"】审核通过":"【"+e.reviewedByName+"】审核不通过":"未审核"},getWeekdayFromDate:function(e){var t=["周日","周一","周二","周三","周四","周五","周六"],a=new Date(e),i=a.getDay();return t[i]}}}),D=y,x=D,F=(a("8799"),Object(R["a"])(x,_,N,!1,null,"68aae620",null)),j=F.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"content"},[a("el-main",[a("vxe-grid",{ref:"xGrid",staticClass:"vxe-table-element",attrs:{border:"full",resizable:"","keep-source":"",height:"350",columns:e.tableColumns,data:e.tableDatas,"edit-config":{trigger:"click",mode:"cell",showStatus:!0,icon:"fa fa-file-text-o"}}}),a("p",{directives:[{name:"show",rawName:"v-show",value:e.canReviewCheck,expression:"canReviewCheck"}],staticStyle:{"text-align":"left"}},[e._v("审核情况："+e._s(e.reviewText())+" ")]),a("div",{staticClass:"checkInfo"},[a("span",[e._v(e._s(e.DEVICE_CHECK.JOB_DESCRIPTION)+":")]),a("el-input",{attrs:{type:"textarea",placeholder:e.CONSTANTS_CODE.PLEASE_ENTER_CONTENT,rows:3,disabled:!0,maxlength:"200","show-word-limit":""},model:{value:e.checkRemarks,callback:function(t){e.checkRemarks=t},expression:"checkRemarks"}}),a("el-upload",{ref:"upload",attrs:{"list-type":"picture-card",disabled:!0,action:e.uploadConfig.url,"file-list":e.fileList,"on-preview":e.handlePictureCardPreview}},[a("i",{staticClass:"el-icon-plus"})]),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),a("div",{staticClass:"btnDiv"},[a("el-select",{on:{change:e.showItem},model:{value:e.selectedShift,callback:function(t){e.selectedShift=t},expression:"selectedShift"}},e._l(e.options,(function(e){return a("el-option",{key:e.shiftId,attrs:{label:e.shiftName+":"+e.shiftStartTime+"~"+e.shiftEndTime,value:e.shiftId}})})),1),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.canReviewCheck,expression:"canReviewCheck"}],attrs:{type:"primary"},on:{click:e.checkReview}},[e._v("审核")]),a("el-button",{on:{click:e.goBack}},[e._v(e._s(e.BTN_TEXT.RETURN))]),a("el-date-picker",{attrs:{readonly:!0,align:"center",type:"day","value-format":"YYYY-MM-DD"},model:{value:e.yearMonthDay,callback:function(t){e.yearMonthDay=t},expression:"yearMonthDay"}})],1),a("el-dialog",{attrs:{title:"提示",visible:e.centerDialogVisible,width:"500px",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("span",[e._v("请对本次点检任务进行审核")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.checkReviewPass()}}},[e._v("通过")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.checkReviewNoPass()}}},[e._v("不通过")])],1)])],1)],1)},P=[],H={components:{HeaderTitle:s["a"],HeadOperationItem:o["a"]},props:{deviceCode:{type:String,default:""},yearMonthDay:{type:String,default:""}},data:function(){var e=this,t=this.$createElement;return{BTN_TEXT:p["c"],CONSTANTS_CODE:p["h"],DEVICE_CHECK:p["o"],selectedShift:null,options:[],checkRemarks:"",tableDatas:[],tableColumns:[{type:"seq",title:p["P"].SEQ,align:"center"},{field:"itemName",title:p["g"].CHECK_ITEM,align:"center"},{field:"checkState",title:p["g"].IS_FINISH,align:"center",slots:{default:function(a){var i=a.row;a.column;return 0===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-unChecked"})]:1===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,2)}},class:"icon-checked"})]:2===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,0)}},class:"icon-no"})]:3===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-stop"})]:4===i.checkState?[t("i",{on:{click:function(){return e.toggleFinish(i,1)}},class:"icon-holiday"})]:void 0}}},{field:"value",title:p["g"].REAL_VALUE,align:"center"}],relationshipId:"",dialogImageUrl:"",fileList:[],delFileList:[],dialogVisible:!1,uploadConfig:{headers:{token:window.localStorage.getItem("token").replace(/"/g,"")},url:p["E"].PUBLICIP+"fileResource/uploadOneFile.action",data:{fileResourceTypeEnum:p["z"].CHECK_RECORD_IMAGE,relationshipId:""}},canReviewCheck:!1,centerDialogVisible:!1,checkRecord:{}}},computed:{},created:function(){},mounted:function(){},methods:{toggleFinish:function(e,t){e.isFinish=t},searchItem:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.tableDatas=[],e.options=[],e.selectedShift=null,""!==e.deviceCode){t.next=6;break}return Object(m["c"])(p["o"].PLEASE_CHOOSE_DEVICE),t.abrupt("return",!1);case 6:return t.prev=6,t.next=9,Object(k["g"])({deviceCode:e.deviceCode,date:e.yearMonthDay+" 00:00:00"});case 9:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.options=a.rows.reverse(),e.selectedShift=a.rows[0].shiftId,e.showItem()):Object(m["c"])(a.message),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),Object(v["a"])(p["N"].NOTIFY,t.t0);case 16:return t.prev=16,t.finish(16);case 18:case"end":return t.stop()}}),t,null,[[6,13,16,18]])})))()},showItem:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.fileList=[],e.checkRemarks="",t.prev=2,t.next=5,Object(k["a"])({deviceCode:e.deviceCode,date:e.yearMonthDay+" 00:00:00",shiftId:e.selectedShift});case 5:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.tableDatas=a.rows.checkList,e.checkRecord=a.rows.checkRecord,e.checkRemarks=a.rows.checkRecord.checkInformation,e.showReviewCheck(),e.getFileList(a.rows.checkImageList)):Object(m["c"])(a.message),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),Object(v["a"])(p["N"].NOTIFY,t.t0);case 12:return t.prev=12,t.finish(12);case 14:case"end":return t.stop()}}),t,null,[[2,9,12,14]])})))()},goBack:function(){this.$emit("toggleHistroyItem")},handleRemove:function(e,t){e.flag?(this.delFileList.push(e.id),this.fileList=t):(this.delFileList.push(e.response.rows.resourceId),this.fileList=t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},updateFiles:function(){if(!this.deviceCode)return Object(m["c"])(p["o"].PLEASE_CHOOSE_DEVICE),!1},updateSuccess:function(e,t,a){this.fileList.push(t),e.code,this.GLOBAL.STATUS_CODE.OPERATION_SUCCESS},getFileList:function(e){var t=e.map((function(e){var t={id:e.resourceId,url:p["E"].PUBLICIP+e.fileUrl,relationshipId:e.relationshipId,flag:!0};return t}));this.delFileList=[],this.fileList=t},showReviewCheck:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(w["a"])({configurationTypeEnum:"CHECK_REVIEW"},{});case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(console.log(a),1===a.rows.isEnable?e.canReviewCheck=!0:e.canReviewCheck=!1):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},checkReview:function(){0===this.checkRecord.checkState?Object(m["c"])("未完成点检，无法进行审核！"):this.centerDialogVisible=!0},checkReviewPass:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["q"])({},[e.checkRecord.recordId]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.centerDialogVisible=!1,Object(m["b"])(a.message),e.showItem()):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},checkReviewNoPass:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["x"])({},[e.checkRecord.recordId]);case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(e.centerDialogVisible=!1,Object(m["b"])(a.message),e.showItem()):Object(m["c"])(a.message),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:return t.prev=9,t.finish(9);case 11:case"end":return t.stop()}}),t,null,[[0,7,9,11]])})))()},reviewText:function(){return this.checkRecord.reviewState?1===this.checkRecord.reviewState?"【"+this.checkRecord.reviewedByName+"】审核通过":"【"+this.checkRecord.reviewedByName+"】审核不通过":"未审核"}}},A=H,M=A,V=(a("3212"),Object(R["a"])(M,L,P,!1,null,"1da0a9d7",null)),U=V.exports,Y={name:"DeviceCheckManagement",components:{HeaderTitle:s["a"],HeadOperationItem:o["a"],ZTree:f["a"],checkItemList:T,checkHistroy:j,checkHistroyItem:U,sHeader:l["a"],HeaderAction:u["a"]},data:function(){return{WORK_STATION:p["R"],DEVICE_CHECK:p["o"],BTN_TEXT:p["c"],CONSTANTS_DEVICE_CONFIGURATION:p["i"],showItem:!1,HeadTitleName:p["i"].DEVICE_LIST,tableName:"device",tabPosition:"now",showModelItem:!1,showPage:0,ztreeObj:{},ztreeSelectedNode:{id:"-1",pId:"-1"},nodeData:[],histroyDay:"",histroyMonth:""}},computed:{},created:function(){this.getTree()},watch:{tabPosition:function(e){var t=this;this.showItem=!1,"now"===e||"prev"===e?setTimeout((function(){t.$refs.checkItemList.searchItem()}),0):"histroy"===e&&setTimeout((function(){t.$refs.checkHistroy.searchItem()}),0)}},methods:{showRole:function(e){var t=Object(C["c"])("id");console.log(t);var a=Object(c["a"])({},this.$store.state.pageInfo[t]);console.log("666",a.buttonList);var i=a.buttonList;if(a.buttonList)for(var r=0;r<i.length;r++)if(e===Number(i[r].type))return!0;return!1},ztreeOnClick:function(e,t,a){var i=this;this.ztreeSelectedNode=t,this.ztreeObj=a,"now"===this.tabPosition||"prev"===this.tabPosition?setTimeout((function(){i.$refs.checkItemList.searchItem()}),0):"histroy"===this.tabPosition&&(this.showItem?setTimeout((function(){i.$refs.checkHistroyItem.searchItem()}),0):setTimeout((function(){i.$refs.checkHistroy.searchItem()}),0))},ztreeHandleCreated:function(e){this.ztreeObj=e},getTree:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$route.query.isWorkstation){t.next=8;break}return t.next=4,Object(k["e"])();case 4:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?e.nodeData=a.rows.map((function(e){return e.code&&(1===e.type?(e.iconSkin="yes",e.isChecked=!0):0===e.type&&(e.iconSkin="no",e.isChecked=!1)),e})):Object(m["c"])(a.message),t.next=12;break;case 8:return t.next=10,Object(k["d"])();case 10:i=t.sent,i.code===p["M"].OPERATION_SUCCESS?e.nodeData=i.rows.map((function(e){return console.log(666,e),e.code&&(1===e.type?(e.iconSkin="yes",e.isChecked=!0):0===e.type&&(e.iconSkin="no",e.isChecked=!1)),e})):Object(m["c"])(i.message);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 17:return t.prev=17,t.finish(17);case 19:case"end":return t.stop()}}),t,null,[[0,14,17,19]])})))()},changeNode:function(e){e?(this.ztreeSelectedNode.iconSkin="yes",this.ztreeSelectedNode.isChecked=!0):(this.ztreeSelectedNode.iconSkin="no",this.ztreeSelectedNode.isChecked=!1),this.ztreeObj.updateNode(this.ztreeSelectedNode)},toggleHistroyItem:function(e,t){var a=this;this.histroyDay=e+"",this.histroyMonth=t+"",this.showItem=!this.showItem,this.showItem?setTimeout((function(){a.$refs.checkHistroyItem.searchItem()}),0):setTimeout((function(){a.$refs.checkHistroy.searchItem()}),0)},holidayFree:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm(p["o"].COMFIRM_HOLIDAY_FREE,p["N"].PROMPT,{confirmButtonText:p["c"].CONFIRM,cancelButtonText:p["c"].CANCEL,type:"warning"}).then((function(){e.setHolidayFree()})).catch((function(){}));case 1:case"end":return t.stop()}}),t)})))()},setHolidayFree:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["z"])({date:d()((new Date).getTime()).format("YYYY-MM-DD")+" 00:00:00",deviceCode:e.ztreeSelectedNode.code});case 3:a=t.sent,a.code===p["M"].OPERATION_SUCCESS?(Object(m["b"])(a.message),e.changeNode(!0),e.$refs.checkItemList.searchItem()):Object(m["c"])(a.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[0,7,10,12]])})))()},holidayAllFree:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm(p["o"].COMFIRM_HOLIDAY_ALL_FREE,p["N"].PROMPT,{confirmButtonText:p["c"].CONFIRM,cancelButtonText:p["c"].CANCEL,type:"warning"}).then((function(){e.setHolidayAllFree()})).catch((function(){}));case 1:case"end":return t.stop()}}),t)})))()},setHolidayAllFree:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(k["z"])({date:d()((new Date).getTime()).format("YYYY-MM-DD")+" 00:00:00"});case 3:if(a=t.sent,a.code===p["M"].OPERATION_SUCCESS)for(i in Object(m["b"])(a.message),e.nodeData)e.nodeData[i].code&&(r=e.ztreeObj.getNodeByParam("code",e.nodeData[i].code,null),r.iconSkin="yes",r.isChecked=!0,e.ztreeObj.updateNode(r));else Object(m["c"])(a.message);t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(v["a"])(p["N"].NOTIFY,t.t0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,null,[[0,7,10,12]])})))()},goHome:function(){this.$router.replace("/workstation/home")}}},B=Y,$=B,z=(a("3d99"),Object(R["a"])($,i,r,!1,null,"9e35effa",null));t["default"]=z.exports},6350:function(e,t,a){"use strict";var i=a("82ff"),r=a.n(i);r.a},"82ff":function(e,t,a){},8799:function(e,t,a){"use strict";var i=a("cae4"),r=a.n(i);r.a},a96d:function(e,t,a){},cae4:function(e,t,a){},eb15:function(e,t,a){}}]);
//# sourceMappingURL=chunk-11aff2a4.045cc4d8.js.map