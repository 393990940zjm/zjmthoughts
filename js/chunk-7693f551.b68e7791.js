(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7693f551"],{"01f6":function(e,t,n){"use strict";var r=n("4ce3"),a=n.n(r);a.a},"1d0c":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("header-buttons",{attrs:{cssType:"99",showBack:"true",showTitle:"true",titleName:"权限设置"},on:{buttonClickEvent:e.buttonClickEvent}})],1),n("el-main",{staticClass:"border-top"},[n("section",{staticClass:"display-grid margin-10 authority-setting-area"},[n("el-card",{staticClass:"custom-card",attrs:{shadow:"never"}},[n("div",{staticClass:"custom-card__slot",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"tree-title"},[e._v("模块")])]),n("div",{staticClass:"scroll-area"},[n("el-scrollbar",{staticStyle:{height:"100%"}},[n("ZTree",{attrs:{nodes:e.treeData,isCheck:!0,isExpendAll:!0},on:{ztreeOnCheck:e.ztreeOnCheck,ztreeHandleCreated:e.ztreeHandleCreated}})],1)],1)]),n("el-card",{staticClass:"custom-card",attrs:{shadow:"never"}},[n("div",{staticClass:"custom-card__slot",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"tree-title"},[e._v("方法")])]),n("div",{staticClass:"scroll-area"},[n("el-scrollbar",{staticStyle:{height:"100%"}},[n("selected-modal-list",{attrs:{"selected-modals":e.selectedModals}})],1)],1)])],1),n("article",{staticStyle:{"text-align":"center"}},[n("el-button",{staticClass:"custom-button",on:{click:e.goBack}},[e._v("返回")]),n("el-button",{staticClass:"custom-button",attrs:{type:"primary"},on:{click:e.saveAuthoritiesForRole}},[e._v("保存")])],1)])],1)},a=[],o=(n("4de4"),n("c740"),n("4160"),n("a434"),n("b0c0"),n("a9e3"),n("159b"),n("3835")),s=n("b85c"),i=(n("96cf"),n("1da1")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return Array.isArray(e.showList)&&0===e.showList.length?n("span",[e._v(" 没有选中的模块 ")]):n("ul",{staticClass:"selected-modal-list"},e._l(e.showList,(function(t){return n("li",{key:t[0].id,staticClass:"custom-li"},[n("span",{staticClass:"width-200 font-weight-bold"},[n("i",{staticClass:"el-icon-folder-add"}),e._v(" "+e._s(t[0].menuName)+" ")]),Array.isArray(t[1])&&t[1].length>0?n("ul",{staticClass:"sub-modal-list"},e._l(t[1],(function(t){return n("div",{key:t.id,staticClass:"sub-modal-list-item"},[n("table",{staticClass:"sub-modal-list-table"},[n("tr",[n("td",{staticClass:"sub-modal-list-itemName"},[e._v(e._s(t.menuName))]),n("td",{staticClass:"sub-modal-list-itemBtn"},[0==t.hasButton.length?n("p",[e._v("未配置页面按钮权限")]):e._e(),e._l(t.hasButton,(function(t){return n("el-checkbox",{key:t.id,model:{value:t.isChecked,callback:function(n){e.$set(t,"isChecked",n)},expression:"btn.isChecked"}},[e._v(" "+e._s(t.buttonName)+"("+e._s(t.cssTypeDesc)+") ")])}))],2)])])])})),0):n("span",{staticClass:"span--no-sub-modal"},[e._v("没有子模块")])])})),0)},c=[],h={name:"SelectedModalList",props:{selectedModals:{type:Array,default:function(){return[]}}},data:function(){return{showList:[]}},watch:{selectedModals:{handler:function(e,t){this.showList=e},immediate:!0,deep:!0}},updated:function(){}},d=h,u=(n("d0a7"),n("2877")),f=Object(u["a"])(d,l,c,!1,null,"4ae5861f",null),p=f.exports,b=n("6f32"),g=n("3fa5"),m=n("cc5e"),v={name:"PageAuthoritySetting",components:{SelectedModalList:p,ZTree:b["a"]},props:{roleId:{type:Number,default:function(){return 0},required:!0}},data:function(){return{pageTitle:"权限设置",firstInit:0,treeData:[],ztreeObj:{},defaultProps:{children:"children",label:"menuName"},roleTreeId:0,selectedModals:[],selectedBtns:[],releBtn:{}}},methods:{buttonClickEvent:function(e){"exit"!==e?this["".concat(e)]():this.goBack()},fetchTreeData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(m["a"])();case 3:n=t.sent,e.treeData=e.dataFormatterTree(n.rows),e.initSelectedModals(),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},dataFormatterTree:function(e){var t=e;for(var n in t)t[n].id=t[n].menuId,t[n].name=t[n].powerCnName,t[n].pId=t[n].menuParentId;for(var r=[],a={},o=0,s=t.length;o<s;o++)a[t[o].id]=t[o];for(o=0,s=t.length;o<s;o++){var i=a[t[o].pId];i?i.children?(delete t[o].url,i.children.push(t[o])):(i.children=[],delete t[o].url,i.children.push(t[o])):r.push(t[o])}return r},isParentNodeInArray:function(e){return-1!==this.selectedModals.findIndex((function(t){return t[0].id===e}))},initSelectedModals:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.firstInit){t.next=13;break}return e.firstInit=1,t.prev=2,t.next=5,Object(m["e"])({roleId:e.roleId});case 5:for(r in n=t.sent,e.releBtn=n,console.log(n.rows),n.rows)if(-1!==n.rows[r].menuParentId)a=e.ztreeObj.getNodeByParam("id",n.rows[r].menuId,null),e.ztreeObj.checkNode(a,!0,!0);else{for(s in o=0,n.rows)n.rows[s].menuParentId===n.rows[r].menuId&&o++;console.log(n.rows[r].powerCnName,o),0===o&&(i=e.ztreeObj.getNodeByParam("id",n.rows[r].menuId,null),e.ztreeObj.checkNode(i,!0,!0))}t.next=13;break;case 11:t.prev=11,t.t0=t["catch"](2);case 13:e.selectedModals.splice(0),l=e.ztreeObj.getNodes(),l.length>0&&l.forEach((function(t){if(t.checked){var n=[],r=[];if(n.push({id:t.id,menuName:t.name,parentId:-1,powerId:t.powerId,hasButton:r}),t.children&&t.children.length>0){var a=[];t.children.filter((function(e){return!0===e.checked})).forEach((function(t){var n=[];t.hasButton.length>0&&t.hasButton.forEach((function(r){var a=e.releBtn.rows;if(a&&a.length>0)for(var o=0;o<a.length;o++)if(t.menuId===a[o].menuId)for(var s=a[o].hasButton,i=0;i<s.length;i++)s[i].id===r.id&&(!1!==r.isChecked?r.isChecked=!0:r.isChecked=!1);n.push(r)}));var r={id:t.id,menuName:t.name,parentId:t.pId,powerId:t.powerId,hasButton:n};a.push(r)})),n.push(a)}else n.push([]);e.firstInit=2,e.selectedModals.push(n)}}));case 16:case"end":return t.stop()}}),t,null,[[2,11]])})))()},saveAuthoritiesForRole:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(m["g"])(e.constructAuthArray());case 3:n=t.sent,n&&(Object(g["b"])("权限设置成功！"),e.saveSelectBtn()),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(g["a"])(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},saveSelectBtn:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(m["f"])({roleId:e.roleId},e.selectedBtns);case 3:n=t.sent,n&&Object(g["b"])("权限角色按钮设置成功！"),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),Object(g["a"])(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},constructAuthArray:function(){var e=this;this.selectedBtns=[];var t,n={roleId:this.roleId,powerIdList:[]},r=Object(s["a"])(this.selectedModals);try{for(r.s();!(t=r.n()).done;){var a=Object(o["a"])(t.value,2),i=a[0],l=a[1];n.powerIdList.push(i.powerId),i.hasButton&&i.hasButton.length>0&&i.hasButton.forEach((function(t){if(t.isChecked){var n={buttonId:t.id,powerId:t.powerId,roleId:e.roleId};e.selectedBtns.push(n)}})),l.length>0&&l.forEach((function(t){n.powerIdList.push(t.powerId),t.hasButton&&t.hasButton.length>0&&t.hasButton.forEach((function(t){if(t.isChecked){var n={buttonId:t.id,powerId:t.powerId,roleId:e.roleId};e.selectedBtns.push(n)}}))}))}}catch(c){r.e(c)}finally{r.f()}return n},goBack:function(){this.$emit("goBack",0)},ztreeHandleCreated:function(e){this.ztreeObj=e},ztreeOnCheck:function(e,t,n){if(console.log(t),-1===t.menuParentId){if(t.children&&t.children.length>0)for(var r=0;r<t.children.length;r++){var a=t.children[r];if(a.hasButton&&a.hasButton.length>0){for(var o=-1,s=0;s<this.releBtn.rows.length;s++)a.menuId===this.releBtn.rows[s].menuId&&(o=0,o=this.releBtn.rows[s].hasButton&&0!==this.releBtn.rows[s].hasButton.length?2:1);if(2!==o)for(var i=0;i<a.hasButton.length;i++)!1===a.hasButton[i].isChecked?a.hasButton[i].isChecked=!1:a.hasButton[i].isChecked=!0}}}else if(t.hasButton&&t.hasButton.length>0){for(var l=-1,c=0;c<this.releBtn.rows.length;c++)t.menuId===this.releBtn.rows[c].menuId&&(l=0,l=this.releBtn.rows[c].hasButton&&0!==this.releBtn.rows[c].hasButton.length?2:1);if(2!==l)for(var h=0;h<t.hasButton.length;h++)!1===t.hasButton[h].isChecked?t.hasButton[h].isChecked=!1:t.hasButton[h].isChecked=!0}this.initSelectedModals()}},created:function(){this.fetchTreeData()}},C=v,w=(n("bf34"),Object(u["a"])(C,r,a,!1,null,"b5941418",null));t["a"]=w.exports},2532:function(e,t,n){"use strict";var r=n("23e7"),a=n("5a34"),o=n("1d80"),s=n("ab13");r({target:"String",proto:!0,forced:!s("includes")},{includes:function(e){return!!~String(o(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},"368a":function(e,t,n){},3835:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return i}));n("a4d3"),n("e01a"),n("d28b"),n("e260"),n("d3b7"),n("3ca3"),n("ddb0");function a(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0)if(n.push(s.value),t&&n.length===t)break}catch(l){a=!0,o=l}finally{try{r||null==i["return"]||i["return"]()}finally{if(a)throw o}}return n}}var o=n("06c5");function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){return r(e)||a(e,t)||Object(o["a"])(e,t)||s()}},"390b":function(e,t,n){},"39df":function(e,t,n){"use strict";var r=n("368a"),a=n.n(r);a.a},"4ce3":function(e,t,n){},5861:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"operation-item",on:{click:e.onOprationItem}},[n("div",{staticClass:"operation-icon"},[e._t("operation-icon")],2),n("div",{staticClass:"operation-span"},[e._t("operation-name")],2)])},a=[],o=(n("b0c0"),{props:{name:{type:String,required:!0}},methods:{onOprationItem:function(){this.$emit("onOprationItem",this.name)}}}),s=o,i=(n("01f6"),n("2877")),l=Object(i["a"])(s,r,a,!1,null,"0cfe45f8",null);t["a"]=l.exports},"5a34":function(e,t,n){var r=n("44e7");e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},"6f32":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("tree",{attrs:{nodes:e.nodes,setting:e.setting},on:{onCreated:e.handleCreated}})],1)},a=[],o=n("f419"),s=n.n(o),i={components:{tree:s.a},props:{isCheck:{type:Boolean,default:!1},isExpendAll:{type:Boolean,default:!1},isOneExpendAll:{type:Boolean,default:!1},nodes:{type:Array,default:function(){return[{}]}}},data:function(){return{selectedNode:null,ztreeObj:null,setting:{check:{enable:this.isCheck},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:"0"}},callback:{onClick:this.onClick,onCheck:this.onCheck,onRightClick:this.onRightClick}}}},computed:{},created:function(){},methods:{onClick:function(e,t,n){this.selectedNode=n,this.$emit("ztreeOnClick",e,n,this.ztreeObj)},onCheck:function(e,t,n){this.$emit("ztreeOnCheck",e,n,this.ztreeObj)},handleCreated:function(e){if(this.ztreeObj=e,this.isExpendAll)e.expandAll(!0);else if(this.isOneExpendAll){var t=e.transformToArray(e.getNodes());e.expandNode(t[0],!0)}this.$emit("ztreeHandleCreated",e)},onRightClick:function(e,t,n){var r={};null===n?r=this.selectedNode:(this.selectedNode=n,r=n),this.ztreeObj.selectNode(r),this.$emit("ztreeOnRightClick",e,r,this.ztreeObj)},getNodesByParam:function(e,t,n){this.ztreeObj.expandAll(!0)},selectNode:function(e,t,n){this.ztreeObj.selectNode(e,t,n)}}},l=i,c=(n("39df"),n("2877")),h=Object(c["a"])(l,r,a,!1,null,"812aacfc",null);t["a"]=h.exports},ab13:function(e,t,n){var r=n("b622"),a=r("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,"/./"[e](t)}catch(r){}}return!1}},bf34:function(e,t,n){"use strict";var r=n("c1f2"),a=n.n(r);a.a},bf39:function(e,t,n){"use strict";var r=n("390b"),a=n.n(r);a.a},c166:function(e,t,n){},c1f2:function(e,t,n){},c740:function(e,t,n){"use strict";var r=n("23e7"),a=n("b727").findIndex,o=n("44d2"),s=n("ae40"),i="findIndex",l=!0,c=s(i);i in[]&&Array(1)[i]((function(){l=!1})),r({target:"Array",proto:!0,forced:l||!c},{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o(i)},caad:function(e,t,n){"use strict";var r=n("23e7"),a=n("4d64").includes,o=n("44d2"),s=n("ae40"),i=s("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:!i},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},cf46:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("vxe-grid",{ref:e.tableName+"Table",staticClass:"vxe-table-element",attrs:{"row-style":e.rowStyle,"header-row-style":e.headerStyle,resizable:e.resizable,border:e.border,"show-header":e.showHeader,"auto-resize":e.autoResize,"header-align":e.headerAlign,"show-footer":e.showFooter,"show-footer-overflow":e.showFooterOverflow,"show-overflow":e.showOverflow,stripe:e.stripe,"max-height":e.maxHeight,height:e.height,size:e.size,"remote-sort":!0,"highlight-hover-row":e.highlightHoverRow,"highlight-current-row":e.highlightCurrentRow,loading:e.tableLoading,"tooltip-config":e.tooltipConfig,"keep-source":e.keepSource,"edit-config":e.editConfig,columns:e.tableColumns,data:e.tableDatas,"checkbox-config":e.checkboxConfig,"radio-config":{trigger:"row"},"seq-config":{startIndex:(e.tablePage.currentPage-1)*e.tablePage.pageSize},"pager-config":e.tablePage,"span-method":e.mergeRowMethod,"export-config":{cellRender:e.handleCellRender}},on:{"cell-click":e.cellClickEvent,"cell-dblclick":e.cellDBLClickEvent,"page-change":e.handlePageChange,"sort-change":e.sortChange,"checkbox-change":e.checkboxChangeEvent,"checkbox-all":e.checkboxChangeEvent,"current-change":e.currentChangeEvent},scopedSlots:e._u([{key:"pager_left",fn:function(){return[n("div",{staticClass:"page-left"},[n("div",[e._t("tableOperation")],2)])]},proxy:!0}],null,!0)})],1)},a=[],o=(n("4de4"),n("caad"),n("a9e3"),n("2532"),{props:{rowStyle:{type:Function},headerStyle:{type:Function},resizable:{type:Boolean,default:!0},tableName:{type:String,required:!0},showHeader:{type:Boolean,default:!0},border:{type:[Boolean,String],default:!0},autoResize:{type:Boolean,default:!0},headerAlign:{type:String,default:"center"},showFooter:{type:Boolean,default:!1},showFooterOverflow:{type:[Boolean,String],default:"tooltip"},showOverflow:{type:[Boolean,String],default:"tooltip"},stripe:{type:Boolean,default:!0},maxHeight:{type:[Number,String],default:""},height:{type:[Number,String],default:"500px"},size:{type:String,default:"small"},highlightHoverRow:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!1},tableLoading:{type:Boolean,default:!1},tooltipConfig:{type:Object,default:function(){return{theme:"light",enterable:!0}}},checkboxConfig:{type:Object,default:function(){return{}}},exportConfig:{type:Object,default:function(){return{}}},keepSource:{type:Boolean,default:!1},editConfig:{type:[Boolean,Object],default:!1},tableDatas:{type:Array,required:!0},tableColumns:{type:Array,required:!0},tablePage:{type:Object,required:!0},checkRecords:{type:Array,default:function(){return[]}}},data:function(){return{isAllChecked:!1,isIndeterminate:!1,selectRecords:[],mergeArr:[]}},watch:{checkRecords:function(e,t){0===e.length&&this.checkboxChangeEvent([])}},methods:{handleCellRender:function(e){var t=e.row,n=e.column,r=e.cellValue;return console.log(666,t,n,r),{style:"color: red;"}},handlePageChange:function(e){var t=e.currentPage,n=e.pageSize;this.isAllChecked=!1,this.selectRecords=[],this.$emit("onTablePageChange",t,n)},sortChange:function(e){e.column;var t=e.property,n=e.order;console.log(666),this.isAllChecked=!1,this.selectRecords=[],this.$emit("sortChange",t,n)},checkboxChangeEvent:function(e){var t=e.records;this.isAllChecked=this.$refs[this.tableName+"Table"].isAllCheckboxChecked(),this.isIndeterminate=this.$refs[this.tableName+"Table"].isCheckboxIndeterminate(),t?this.selectRecords=t:(this.selectRecords=[],this.isIndeterminate=!1),0===this.selectRecords.length&&(this.isAllChecked=!1),this.$emit("chooseCheck",t)},changeAllEvent:function(){this.$refs[this.tableName+"Table"].setAllCheckboxRow(this.isAllChecked),this.selectRecords=this.$refs[this.tableName+"Table"].getCheckboxRecords(),0===this.selectRecords.length&&(this.isAllChecked=!1),this.$emit("chooseCheck",this.selectRecords)},exportData:function(e,t,n){console.log(n);var r={isColgroup:!0,filename:e,useStyle:!0,type:"xlsx",columns:n.filter((function(e){return console.log(e),""!==e.field})),data:t};this.$refs[this.tableName+"Table"].exportData(r)},exportDatax:function(e,t,n){console.log(n);var r={isColgroup:!0,filename:e,useStyle:!0,type:"csv",data:t};n&&(r.columnFilterMethod=function(e){return n.includes(e.property)}),this.$refs[this.tableName+"Table"].exportData(r)},cellClickEvent:function(e){var t=e.row;this.$emit("clickRows",t)},cellDBLClickEvent:function(e){var t=e.row;this.$emit("dbclickRows",t)},currentChangeEvent:function(e){var t=e.row,n=this.$refs[this.tableName+"Table"].$getRowIndex(t);this.$emit("currentChangeEvent",t,n)},setCurrentRow:function(e){this.$refs[this.tableName+"Table"].setCurrentRow(this.tableDatas[e])},clearCurrentRow:function(){this.$refs[this.tableName+"Table"].clearCurrentRow()},toggleCheckboxRow:function(e){this.$refs[this.tableName+"Table"].toggleCheckboxRow(e)},clearCheckboxRow:function(){this.$refs[this.tableName+"Table"].clearCheckboxRow()},getCheckboxRecords:function(){return this.$refs[this.tableName+"Table"].getCheckboxRecords()},getRadioRecord:function(){return this.$refs[this.tableName+"Table"].getRadioRecord()},setCheckboxRow:function(e,t){return this.$refs[this.tableName+"Table"].setCheckboxRow(e,t)},mergeRowMethod:function(e){var t=e.row,n=e.$rowIndex,r=e.column,a=e.data,o=this.mergeArr;if(this.mergeArr.length>0){var s=t[r.property];if(s&&o.includes(r.property)){var i=t[o[0]],l=a[n-1],c=a[n+1];if(l&&l[r.property]===s&&l[o[0]]===i)return{rowspan:0,colspan:0};var h=1;while(c&&c[r.property]===s&&c[o[0]]===i)c=a[++h+n];if(h>1)return{rowspan:h,colspan:1}}}}}}),s=o,i=(n("bf39"),n("2877")),l=Object(i["a"])(s,r,a,!1,null,"00902082",null);t["a"]=l.exports},d0a7:function(e,t,n){"use strict";var r=n("c166"),a=n.n(r);a.a}}]);
//# sourceMappingURL=chunk-7693f551.b68e7791.js.map