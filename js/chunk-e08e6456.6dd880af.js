(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e08e6456"],{"049f":function(e,t,n){},"1aed":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"kanban"},[n("Header",{attrs:{titleName:"车间稼动率看板"}}),n("search-bar",{attrs:{searchData:e.searchData,searchOptions:e.searchOptions},on:{search:e.handleSearch}}),n("div",{staticClass:"kanbanContent"},[n("div",{staticClass:"top_content"},[n("card-module",{attrs:{title:"稼动率",cardBg:"cardBg_large",titleBg:"cardTitle_large",width:"100%",height:"100%",titleWidth:"70%",isExport:!1}},[n("div",{ref:"Utilization",staticStyle:{width:"100%",height:"100%"}})])],1),n("div",{staticClass:"bottom_content"},[n("card-module",{attrs:{title:e.yiledKey,width:"50%",height:"100%",titleWidth:"80%",isExport:!1}},[n("div",{ref:"Production",staticStyle:{width:"100%",height:"100%"}})]),n("card-module",{attrs:{title:"设备状态",width:"49%",height:"100%",titleWidth:"80%",isExport:!1}},[n("div",{ref:"DeviceState",staticStyle:{width:"100%",height:"100%"}})])],1)])],1)},a=[],r=(n("7db0"),n("4160"),n("d81d"),n("fb6a"),n("b0c0"),n("b680"),n("4d63"),n("ac1f"),n("25f0"),n("5319"),n("159b"),n("96cf"),n("1da1")),o=n("cf45"),c=n("99f6"),s=n("5995"),u=n("78fe"),l=n("e9c43"),d=n("ef53"),f=n("f82c"),h=n("7598"),p={name:"kanban_hx_workshopcapacity",components:{CardModule:u["a"],searchBar:l["a"],Header:s["a"]},data:function(){return{title:"",groupId:0,time:"",dataTime:"",searchData:{groupValue:[1,6,7],date:[new Date(Object(d["b"])(6)+" 00:00:00"),new Date(Object(d["b"])(0)+" 23:59:59")],timeKeyEnum:"DAY"},searchOptions:[{type:"cascader",key:"groupValue",name:"车间",options:[]},{type:"daterange",key:"date",name:"时间",options:[{label:"日",value:"DAY"},{label:"周",value:"WEEK"},{label:"月",value:"MONTH"}]}],kanbanConfig:{title:"",key:"",time:15e3},timer:null,timer2:null,prodChartXData:[],prodChartData:[],prodChartDevices:[],yiledKey:"产量",groupLineDeviceList:[],allDeviceCode:[],currentIndex:0}},mounted:function(){var e=this;document.documentElement.style.fontSize=this.fontSize()+"px",window.onresize=function(){document.documentElement.style.fontSize=e.fontSize()+"px"},this.$nextTick((function(){e.loadData()})),this.timer2&&clearInterval(this.timer2),this.timer2=setInterval((function(){e.loadData()}),this.kanbanConfig.time||36e5)},created:function(){var e=this;c["m"][this.getUrlKeyMain("cid",window.location.href)]&&(e.kanbanConfig=c["m"][this.getUrlKeyMain("cid",window.location.href)]),this.getGroupLineDevice(),this.getYieldConfig()},destroyed:function(){this.timer&&clearInterval(this.timer),this.timer2&&clearInterval(this.timer2)},methods:{getGroupLineDevice:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={isProductionDevice:1},t.next=4,Object(h["n"])(n,{secretKey:e.kanbanConfig.key});case 4:for(i=t.sent,a=0;a<i.rows.length;a++)i.rows[a].code&&(i.rows[a].id=i.rows[a].code);e.groupLineDeviceList=i.rows,r=Object(f["a"])(i.rows),e.searchOptions[0].options=r,e.getDeviceCodes(),e.getUtilizationData(),e.timer&&clearInterval(e.timer),e.timer=setInterval((function(){e.getUtilizationData()}),2e4),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},getDeviceCodes:function(){var e=this.searchData.groupValue;if(e){var t=e[e.length-1];isNaN(t)?this.allDeviceCode=[t]:this.allDeviceCode=this.groupLineDeviceList.find((function(e){return e.id===t})).children.map((function(e){return e.value}))}},fontSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(t){var n=t/1920;return e*n}},showLogo:function(){return"logo_"+this.kanbanConfig.logo},getUrlKeyMain:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t)||["",""])[1].replace(/\+/g,"%20"))||null},getYieldConfig:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={},e.getUrlKeyMain("cid",window.location.href)&&(n.secretKey=e.kanbanConfig.key),t.next=5,Object(h["p"])({configurationTypeEnum:"PRODUCTION_CONFIGURATION"},n);case 5:i=t.sent,"0000"===i.code&&(e.yiledKey=(null===(a=i.rows)||void 0===a?void 0:a.processConfiguration)||"产量"),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](0);case 11:return t.prev=11,t.finish(11);case 13:case"end":return t.stop()}}),t,null,[[0,9,11,13]])})))()},getUtilizationData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,o,c,s,u,l,d,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,i=e.searchData,a=i.timeKeyEnum,r=i.date,o=[],c=e.allDeviceCode.length,0!==c){t.next=6;break}return t.abrupt("return");case 6:return c>3?(o=e.allDeviceCode.slice(e.currentIndex,e.currentIndex+3),e.currentIndex=(e.currentIndex+3)%c,e.currentIndex<3&&(e.currentIndex=0)):o=e.allDeviceCode,s={queryDateTypeEnum:a,startTime:r[0],endTime:r[1],deviceCodes:o},u={secretKey:e.kanbanConfig.key},t.next=11,Object(h["B"])(s,u);case 11:l=t.sent,d=[],f=[],(null===l||void 0===l||null===(n=l.rows)||void 0===n?void 0:n.length)>0&&(d=l.rows[0].timeAndValueVoList.map((function(e){return e.time.substr(5,5)})),f=l.rows.map((function(e){return{name:e.deviceName,value:e.timeAndValueVoList.map((function(e){return e.value}))}}))),e.drawUtilizationChart(d,f),t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),console.log(t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))()},getProductionData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,o,c,s,u,l,d,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,i=e.searchData,a=i.timeKeyEnum,r=i.date,o=i.groupValue,c={queryDateTypeEnum:a,startTime:r[0],endTime:r[1]},s={conditionJson1:[],secretKey:e.kanbanConfig.key},o&&(u=o[o.length-1],isNaN(u)?s.conditionJson1.push({column:"deviceCode",ptype:"string",type:"eq",value:u}):s.conditionJson1.push({column:"groupId",ptype:"int",type:"eq",value:u})),t.next=7,Object(h["G"])(c,s);case 7:l=t.sent,d=[],f=[],(null===l||void 0===l||null===(n=l.rows)||void 0===n?void 0:n.length)>0&&l.rows.forEach((function(e){d.push(e.time.substr(5,5)),f.push(e.value)})),e.drawProductionChart(d,f),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](0),console.log(t.t0),e.drawProductionChart([],[]);case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()},getDeviceStateData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,o,c,s,u,l,d,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=e.searchData,i=n.timeKeyEnum,a=n.date,r=n.groupValue,o={queryDateTypeEnum:i,startTime:a[0],endTime:a[1]},c={conditionJson1:[],secretKey:e.kanbanConfig.key},r&&(s=r[r.length-1],isNaN(s)?c.conditionJson1.push({column:"deviceCode",ptype:"string",type:"eq",value:s}):c.conditionJson1.push({column:"groupId",ptype:"int",type:"eq",value:s})),t.next=7,Object(h["D"])(o,c);case 7:u=t.sent,l=[],d=[],f=[],u.rows.length>0&&u.rows.forEach((function(e){l.push(e.reportTime.substr(5,5)),d.push(parseFloat(e.runTimeSum.toFixed(2))),f.push(parseFloat(e.idleTimeSum.toFixed(2)))})),e.drawDeviceStateChart(l,d,f),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},drawProductionChart:function(e,t){var n=this.$echarts.init(this.$refs.Production),i={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"12%",left:"3%",right:"8%",bottom:"8%",containLabel:!0},xAxis:[{type:"category",data:e,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},name:"日期",nameGap:"5"}],yAxis:[{type:"value",name:"",minInterval:1,axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},splitLine:{show:!1}}],series:[{type:"bar",barWidth:"35%",itemStyle:{color:"#EE8231"},label:{show:!0,position:"top",color:"#ffffff"},data:t}]};n.setOption(i,!0),window.addEventListener("resize",(function(){n.resize()}))},drawDeviceStateChart:function(e,t,n){var i=this.$echarts.init(this.$refs.DeviceState),a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"12%",left:"3%",right:"8%",bottom:"8%",containLabel:!0},legend:{top:"0",right:"2%",textStyle:{color:"#ffffff"}},xAxis:[{type:"category",data:e,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},name:"日期",nameGap:"5"}],yAxis:[{type:"value",name:"分钟",axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},splitLine:{show:!1}}],series:[{type:"bar",name:"运行",stack:"state",barWidth:"40%",itemStyle:{color:"#09DBA0"},label:{show:!1,position:"top",color:"#ffffff"},data:t},{type:"bar",name:"空闲",stack:"state",barWidth:"40%",itemStyle:{color:"#fecf11"},label:{show:!1,position:"top",color:"#ffffff"},data:n}]};i.setOption(a,!0),window.addEventListener("resize",(function(){i.resize()}))},drawUtilizationChart:function(e,t){var n=this.$echarts.init(this.$refs.Utilization),i=["#9E87FF","#73DDFF","#fe9a8b","#F56948","#9E87FF"],a={grid:{top:"12%",left:"3%",right:"4%",bottom:"8%",containLabel:!0},legend:{icon:"circle",top:"2%",right:"5%",itemWidth:Object(o["b"])(15),itemGap:Object(o["b"])(40),textStyle:{color:"#ffffff"}},tooltip:{trigger:"axis",axisPointer:{type:"line"}},xAxis:[{type:"category",data:e,boundaryGap:!1,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},name:""}],yAxis:[{type:"value",name:"产量",axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},splitLine:{show:!1}},{type:"value",name:"",axisLine:{lineStyle:{color:"#929EE6"}},axisLabel:{fontSize:Object(o["b"])(14),color:"#D8D8D8"},nameTextStyle:{fontSize:Object(o["b"])(14)},splitLine:{show:!1}}],series:t.map((function(e,t){return{name:e.name,type:"line",data:e.value,symbolSize:1,symbol:"circle",smooth:!0,yAxisIndex:0,showSymbol:!1,lineStyle:{width:Object(o["b"])(5),shadowColor:"rgba(158,135,255, 0.3)",shadowBlur:10,shadowOffsetY:20},itemStyle:{normal:{color:i[t],borderColor:i[t]}}}}))};n.setOption(a,!0),window.addEventListener("resize",(function(){n.resize()}))},handleSearch:function(){this.currentIndex=0,this.getDeviceCodes(),this.getUtilizationData(),this.loadData()},loadData:function(){this.getProductionData(),this.getDeviceStateData()}}},g=p,v=(n("7dc0"),n("2877")),m=Object(v["a"])(g,i,a,!1,null,"3803367e",null);t["default"]=m.exports},"7dc0":function(e,t,n){"use strict";var i=n("049f"),a=n.n(i);a.a},ef53:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"h",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l}));n("a15b");function i(){var e=(new Date).getFullYear(),t=(new Date).getMonth()+1,n=(new Date).getDate();return t=t<10?"0"+t:t,n=n<10?"0"+n:n,[e,t,n].join("-")+" 00:00:00"}function a(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")+" 00:00:00"}function r(){var e=(new Date).getFullYear(),t=(new Date).getMonth()+1,n=(new Date).getDate();return t=t<10?"0"+t:t,n=n<10?"0"+n:n,[e,t,n].join("-")+" 23:59:59"}function o(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")+" 23:59:59"}function c(e){var t=new Date((new Date).getTime()-864e5*e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")}function s(e,t){var n=new Date(t-864e5*e),i=n.getFullYear(),a=n.getMonth()+1,r=n.getDate();return a=a<10?"0"+a:a,r=r<10?"0"+r:r,[i,a,r].join("-")}function u(){var e=new Date;e.setDate(1);var t=e.getFullYear(),n=e.getMonth()+1;n=n>10?n:"0"+n;var i=e.getDate();return i=i<10?"0"+i:i,t+"-"+n+"-"+i}function l(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1;n=n>10?n:"0"+n;var i=new Date(t,n,1);console.log(i);var a=864e5,r=new Date(i-a),o=r.getDate();return console.log(o),o=o<10?"0"+o:o,t+"-"+n+"-"+o}},f82c:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"m",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"j",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"k",(function(){return h})),n.d(t,"l",(function(){return p})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return v})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return b}));n("7db0"),n("a15b"),n("d81d"),n("b0c0"),n("d3b7");var i=n("b85c"),a=n("53ca"),r=n("b775");function o(){return new Promise((function(e,t){r["i"].post("deviceGroup/getAllGroupAndDevice.action").then((function(t){for(var n=0;n<t.data.rows.length;n++)t.data.rows[n].code&&(t.data.rows[n].id=t.data.rows[n].code);t.data.rows=d(t.data.rows),e(t.data)})).catch((function(e){t(e.data)}))}))}function c(){return new Promise((function(e,t){r["i"].post("deviceWorkshopType/getTree.action").then((function(t){t.data.rows=d(t.data.rows),e(t.data)})).catch((function(e){t(e.data)}))}))}function s(){return new Promise((function(e,t){r["i"].post("deviceGroup/getListGroupAndProductionLine.action").then((function(t){t.data.rows=d(t.data.rows),e(t.data)})).catch((function(e){t(e.data)}))}))}function u(){return new Promise((function(e,t){r["i"].post("deviceGroup/getTree.action?").then((function(t){t.data.rows=d(t.data.rows),e(t.data)})).catch((function(e){t(e.data)}))}))}function l(){return new Promise((function(e,t){r["i"].post("materialsType/getTree.action?").then((function(t){t.data.rows?t.data.rows=d(t.data.rows):t.data.rows=[],e(t.data)})).catch((function(e){t(e.data)}))}))}function d(e){var t=e;for(var n in t)t[n].value=t[n].id,t[n].label=t[n].name;for(var i=[],a={},r=0,o=t.length;r<o;r++)a[t[r].id]=t[r];for(r=0,o=t.length;r<o;r++){var c=a[t[r].pId];c?(c.children||(c.children=[]),c.children.push(t[r])):i.push(t[r])}return i}function f(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===Object(a["a"])(e))for(var n in e)e.hasOwnProperty(n)&&(e[n]&&"object"===Object(a["a"])(e[n])?t[n]=this.deepClone(e[n]):t[n]=e[n]);return t}function h(e,t){var n=[];if(Array.isArray(e)&&Array.isArray(t)){if(e.length>0){var a,r=Object(i["a"])(e);try{var o=function(){var e=a.value,i=t.find((function(t){return t.field===e.field}));if(i){var r=Object.assign({},i,{minWidth:e.width,visible:e.visible,required:e.required});n.push(r)}};for(r.s();!(a=r.n()).done;)o()}catch(d){r.e(d)}finally{r.f()}t[1].type&&"checkbox"===t[1].type&&n.unshift(t[1]),t[0].type&&"radio"===t[0].type&&n.unshift(t[0]),t[0].type&&"checkbox"===t[0].type&&n.unshift(t[0]),console.log("7788",e,t,n);for(var c=0;c<t.length;c++)if(t[c].eType){for(var s=0,u=0;u<e.length;u++)t[c].field===e[u].field&&(s+=1);0===s&&n.push(t[c])}var l=t.length;return t[l-1].title&&"操作"===t[l-1].title&&n.push(t[l-1]),console.log("9999",n),n}return t}return[]}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i={conditionJson1:e,operatorGroup:t,conditionJson2:n};return i}function g(e,t){return t.map((function(t,n){return e.map((function(e){return null==t[e]||""===t[e]?"-":t[e]}))}))}function v(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")}function m(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")+" 00:00:00"}function b(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,[n,i,a].join("-")+" 23:59:59"}}}]);
//# sourceMappingURL=chunk-e08e6456.6dd880af.js.map